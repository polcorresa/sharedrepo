# T5.1 Summary: Tree & Files Data Model

## Overview
Implemented the data access layer for the file tree structure (folders, files) and file contents.

## Components

### 1. Folder Repository (`packages/db/src/repositories/folder.repository.ts`)
- **CRUD**: Create, Read, Update (Rename/Move), Delete.
- **Validation**:
  - Duplicate name checks within the same parent.
  - Cycle detection when moving folders.
  - Optimistic concurrency control using `version` field.
- **Queries**:
  - `findRootFolders`: Get top-level folders.
  - `findChildren`: Get sub-folders.

### 2. File Repository (`packages/db/src/repositories/file.repository.ts`)
- **CRUD**: Create, Read, Update (Rename/Move), Delete.
- **Validation**:
  - Duplicate name checks within the same folder.
  - Optimistic concurrency control using `version` field.
- **Features**:
  - Auto-detects `language_hint` from file extension.
  - Tracks `size_bytes`.

### 3. File Content Repository (`packages/db/src/repositories/file-content.repository.ts`)
- **Storage**: Manages the actual text content of files.
- **Operations**:
  - `set`: Upsert (Insert or Update) content.
  - `getFilesWithContent`: Efficient join for generating archives (ZIP).
  - Updates `files.size_bytes` automatically on content change.

## Verification
- `pnpm --filter @sharedrepo/db typecheck` passed.
- Repositories handle complex logic like cycle detection and concurrency.
