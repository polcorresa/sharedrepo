# T4.1 Summary: Repo Endpoints

## Overview
Implemented the core repository management endpoints: status check, creation, login, and logout.

## Components

### 1. Database Layer (`@sharedrepo/db`)
- **RepoRepository**: Handles CRUD operations for `repos` table.
  - `create`: Creates new repo.
  - `findBySlug`: Finds repo by slug (checks expiry).
  - `updateLastAccessed`: Updates timestamp on login.
  - `isSlugAvailable`: Checks if slug is free.

### 2. Service Layer (`@sharedrepo/server`)
- **RepoService**: Business logic.
  - `getStatus`: Returns 'available' or 'exists'.
  - `create`: Hashes password, creates repo, creates root folder, issues JWT.
  - `login`: Verifies password, updates timestamp, issues JWT.
  - **Metrics**: Increments `repo_operations_total` for create and login.

### 3. API Layer (`@sharedrepo/server`)
- **Routes** (`/api/repos`):
  - `GET /:slug/status`: Public endpoint to check repo state.
  - `POST /`: Create new repo.
  - `POST /:slug/login`: Login with password.
  - `POST /:slug/logout`: Clear cookie.
  - `GET /:slug`: Get metadata (protected).
- **Auth Plugin**:
  - `verifyRepoAccess`: Validates JWT from `repo_token` cookie.
  - `verifyRepoSlug`: Ensures token matches the requested slug.
- **Schemas**: Shared Zod schemas in `@sharedrepo/shared`.

## Verification
- `pnpm --filter @sharedrepo/server typecheck` passed.
- Endpoints are registered in `server.ts`.
